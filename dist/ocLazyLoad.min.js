/**
 * ocLazyLoad - Load modules on demand (lazy load) with angularJS
 * @version v0.2.0
 * @link https://github.com/ocombe/ocLazyLoad
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(){"use strict";function e(e){var n=[];return angular.forEach(e.requires,function(e){-1===i.indexOf(e)&&n.push(e)}),n}function n(e){try{angular.module(e)}catch(n){if(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)return!1}return!0}function r(e,n,r){if(n){var o,a,u,i;try{for(o=0,a=n.length;a>o;o++)if(u=n[o],angular.isArray(u)){if(!e.hasOwnProperty(u[0]))return r.error("unsupported provider "+u[0]);i=e[u[0]],t(u[2][0])&&i[u[1]].apply(i,u[2])}}catch(l){throw r.error(l.message),l}}}function o(e,n,t){if(n){var u,l,c,f=[];for(u=n.length-1;u>=0;u--)l=n[u],"string"!=typeof l&&(l=a(l)),l&&(c=angular.module(l),-1===i.indexOf(l)&&(i.push(l),o(e,c.requires,t),f=f.concat(c._runBlocks)),r(e,c._invokeQueue,t),r(e,c._configBlocks,t),n.pop());var s=e.getInstanceInjector();angular.forEach(f,function(e){try{s.invoke(e)}catch(n){n.message&&(n.message+=" from "+l),t.error(n.message)}})}return null}function t(e){var n=!1;return angular.isString(e)?-1===l.indexOf(e)&&(n=!0,l.push(e)):angular.forEach(e,function(e){angular.isString(e)&&-1===l.indexOf(e)&&(n=!0,l.push(e))}),n}function a(e){return e.name?e.name:null}function u(e){function n(e){return e&&a.push(e)}var r,o,a=[e],u=["ng:app","ng-app","x-ng-app","data-ng-app"],l=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(u,function(r){u[r]=!0,n(document.getElementById(r)),r=r.replace(":","\\:"),e.querySelectorAll&&(angular.forEach(e.querySelectorAll("."+r),n),angular.forEach(e.querySelectorAll("."+r+"\\:"),n),angular.forEach(e.querySelectorAll("["+r+"]"),n))}),angular.forEach(a,function(n){if(!r){var t=" "+e.className+" ",a=l.exec(t);a?(r=n,o=(a[2]||"").replace(/\s+/g,",")):angular.forEach(n.attributes,function(e){!r&&u[e.name]&&(r=n,o=e.value)})}}),r&&!function c(e){if(-1===i.indexOf(e)){console.log(e),i.push(e);var n,r,o,a=angular.module(e),u=a._invokeQueue;try{for(n=0,r=u.length;r>n;n++)o=u[n],angular.isArray(o)&&t(o[2][0])}catch(l){throw $log.error(l.message),l}angular.forEach(a.requires,c)}}(o)}var i=["ng"],l=[],c=angular.module("oc.lazyLoad",["ng"]);c.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function(r,t,a,l,c,f){function s(e,n){if(-1===filesLoaded.indexOf(n)){var r;switch(e){case"css":r=document.createElement("link"),r.type="text/css",r.rel="stylesheet",r.href=n;break;default:throw'Requested type "'+e+'" is not known. Could not inject "'+n+'"'}filesLoaded.push(n),h.insertBefore(r,h.lastChild)}}var d,g={},p=[],m={$controllerProvider:r,$compileProvider:a,$filterProvider:l,$provide:t,$injector:c,$animateProvider:f},h=document.getElementsByTagName("head")[0];null===h&&(h=document.getElementsByTagName("body")[0]),this.$get=["$timeout","$log","$q","$templateCache","$http","$rootElement",function(r,t,a,u,l,c){var f;return m.getInstanceInjector=function(){return f?f:f=c.data("$injector")},{getModuleConfig:function(e){return g[e]?g[e]:null},setModuleConfig:function(e){return g[e.name]=e,e},getModules:function(){return i},getModuleName:function(e){var n;return n="string"==typeof e?e:"object"==typeof e&&e.hasOwnProperty("name")&&"string"==typeof e.name?e.name:void 0},loadTemplateFile:function(e,n){angular.isString(e)&&(e=[e]);var r=[];return angular.forEach(e,function(e){var o=a.defer();r.push(o.promise),-1===p.indexOf(e)||angular.isDefined(n)&&n.cache===!1?l.get(e,n).success(function(n){angular.forEach(angular.element(n),function(e){"SCRIPT"===e.nodeName&&"text/ng-template"===e.type&&u.put(e.id,e.innerHTML)}),p.push(e),o.resolve()}).error(function(n){t.error('Error load template "'+e+'": '+n)}):o.resolve()}),a.all(r)},load:function(u){var l,c,f=this,g=null,p=[],h=[],v=a.defer();if(angular.isArray(u))return angular.forEach(u,function(e){h.push(f.load(e))}),a.all(h).then(function(){v.resolve()}),v.promise;if(l=f.getModuleName(u),"string"==typeof u?g=f.getModuleConfig(u):"object"==typeof u&&(g=f.setModuleConfig(u)),null===g)throw c='Module "'+l+'" is not configured, cannot load.',t.error(c),c;if(p.push=function(e){-1===this.indexOf(e)&&Array.prototype.push.apply(this,arguments)},n(l)&&-1!==i.indexOf(l)&&(p.push(l),angular.isUndefined(g.files)))return v.resolve(),v.promise;var y=function $(r){var o,u,i,l,c=[];return o=f.getModuleName(r),u=angular.module(o),i=e(u),angular.forEach(i,function(e){var u,i;if("string"==typeof e){if(u=f.getModuleConfig(e),null===u)return void p.push(e);e=u}return n(e.name)||-1!==p.indexOf(e.name)?void("string"!=typeof r&&t.warn('Module "',o,'" attempted to redefine configuration for dependency "',e.name,'"\nExisting:',f.getModuleConfig(e.name),"Ignored:",e)):("object"==typeof e&&(e.hasOwnProperty("name")&&e.name&&(f.setModuleConfig(e),p.push(e.name)),e.hasOwnProperty("css")&&0!==e.css.length&&angular.forEach(e.css,function(e){s("css",e)})),void(e.hasOwnProperty("files")&&0!==e.files.length&&(i=a.defer(),e.files&&(c.push(i.promise),d(e.files,function(){$(e).then(function(){i.resolve()})})))))}),l=a.defer(),a.all(c).then(function(){l.resolve()}),l.promise};return d(g.files,function(){p.push(l),y(l).then(function(){o(m,p,t),r(function(){v.resolve(g)})})}),v.promise}}}],this.config=function(e){if("undefined"==typeof e.asyncLoader)throw"You need to define an async loader such as requireJS or script.js";if(d=e.asyncLoader,u(angular.element(window.document)),e.loadedModules){var n=function(e){i.indexOf(e)<0&&(i.push(e),angular.forEach(angular.module(e).requires,n))};angular.forEach(e.loadedModules,n)}e.modules&&(angular.isArray(e.modules)?angular.forEach(e.modules,function(e){g[e.name]=e}):g[e.modules.name]=e.modules)}}]),c.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache",function(e,n,r,o,t,a){return{link:function(t,u,i){function l(){f&&(f.$destroy(),f=null),u.html("")}function c(r,o){var t;"undefined"!=typeof(t=a.get(r))?o(t):e.get(r).success(function(e){a.put("view:"+r,e),o(e)}).error(function(e){n.error('Error load template "'+r+'": '+e)})}var f,s=t.$eval(i.ocLazyLoad).onload||"";t.$watch(i.ocLazyLoad,function(e){e?r.load(e).then(function(e){e.template&&c(e.template,function(e){f=t.$new(),u.html(e);var n=u.contents(),r=o(n);r(f),f.$emit("$includeContentLoaded"),f.$eval(s)})}):l()})}}}])}();