/**
 * ocLazyLoad - Load modules on demand (lazy load) with angularJS
 * @version v0.2.0
 * @link https://github.com/ocombe/ocLazyLoad
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(){"use strict";function e(e){var n=[];return angular.forEach(e.requires,function(e){-1===l.indexOf(e)&&n.push(e)}),n}function n(e){try{return angular.module(e)}catch(n){if(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)return!1}}function r(e){try{return angular.module(e)}catch(n){throw(/No module/.test(n)||n.message.indexOf("$injector:nomod")>-1)&&(n.message='The module "'+e+'" that you are trying to load does not exist. '+n.message),n}}function t(e,n){if(n){var r,t,a,u;for(r=0,t=n.length;t>r;r++)if(a=n[r],angular.isArray(a)){if(!e.hasOwnProperty(a[0]))throw new Error("unsupported provider "+a[0]);u=e[a[0]],o(a[2][0])&&u[a[1]].apply(u,a[2])}}}function a(e,n){if(n){var r,o,i,s=[];for(r=n.length-1;r>=0;r--)o=n[r],"string"!=typeof o&&(o=u(o)),o&&(i=angular.module(o),-1===l.indexOf(o)&&(l.push(o),a(e,i.requires),s=s.concat(i._runBlocks)),t(e,i._invokeQueue),t(e,i._configBlocks),n.pop());var c=e.getInstanceInjector();angular.forEach(s,function(e){c.invoke(e)})}}function o(e){var n=!1;if(angular.isString(e))-1===s.indexOf(e)&&(n=!0,s.push(e));else{if(!angular.isObject(e))return!0;angular.forEach(e,function(e){angular.isString(e)&&-1===s.indexOf(e)&&(n=!0,s.push(e))})}return n}function u(e){if(null===e)return null;var n=null;return"string"==typeof e?n=e:"object"==typeof e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&(n=e.name),n}function i(e){function n(e){return e&&a.push(e)}var r,t,a=[e],u=["ng:app","ng-app","x-ng-app","data-ng-app"],i=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;angular.forEach(u,function(r){u[r]=!0,n(document.getElementById(r)),r=r.replace(":","\\:"),e.querySelectorAll&&(angular.forEach(e.querySelectorAll("."+r),n),angular.forEach(e.querySelectorAll("."+r+"\\:"),n),angular.forEach(e.querySelectorAll("["+r+"]"),n))}),angular.forEach(a,function(n){if(!r){var a=" "+e.className+" ",o=i.exec(a);o?(r=n,t=(o[2]||"").replace(/\s+/g,",")):angular.forEach(n.attributes,function(e){!r&&u[e.name]&&(r=n,t=e.value)})}}),r&&!function s(e){if(-1===l.indexOf(e)){l.push(e);var n,r,t,a=angular.module(e),u=a._invokeQueue;for(n=0,r=u.length;r>n;n++)t=u[n],angular.isArray(t)&&o(t[2][0]);if(angular.isDefined(a._configBlocks)){var n,r,t,u=a._configBlocks;for(n=0,r=u.length;r>n;n++)t=u[n],angular.isArray(t)&&o(t[2][0])}angular.forEach(a.requires,s)}}(t)}var l=["ng"],s=[],c=[],f=angular.module("oc.lazyLoad",["ng"]);f.provider("$ocLazyLoad",["$controllerProvider","$provide","$compileProvider","$filterProvider","$injector","$animateProvider",function(t,o,s,f,d,g){var p,h,m,v={},y=[],$={$controllerProvider:t,$compileProvider:s,$filterProvider:f,$provide:o,$injector:d,$animateProvider:g},E=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],j=!1;i(angular.element(window.document)),this.$get=["$timeout","$log","$q","$templateCache","$http","$rootElement",function(t,o,i,s,f,d){var g;j||(o={},o.error=angular.noop,o.warn=angular.noop),$.getInstanceInjector=function(){return g?g:g=d.data("$injector")};var w=function(e,n){var r=i.defer();if(-1===c.indexOf(n)){var t,a;switch(e){case"css":t=document.createElement("link"),t.type="text/css",t.rel="stylesheet",t.href=n;break;case"js":t=document.createElement("script"),t.src=n;break;default:r.reject(new Error('Requested type "'+e+'" is not known. Could not inject "'+n+'"'))}t.onload=t.onreadystatechange=function(){t.readyState&&!/^c|loade/.test(t.readyState)||a||(t.onload=t.onreadystatechange=null,a=1,c.push(n),r.resolve())},t.onerror=function(){r.reject(new Error("Unable to load "+n))},t.async=1,E.insertBefore(t,E.lastChild)}return r.promise};p=p||function(e,n){var r=[];angular.forEach(e,function(e){r.push(w("js",e))}),i.all(r).then(function(){n()},function(e){n(e)})},h=h||function(e,n){var r=[];angular.forEach(e,function(e){r.push(w("css",e))}),i.all(r).then(function(){n()},function(e){n(e)})},m=m||function(e,n,r){angular.isString(e)&&(e=[e]),angular.isFunction(n)&&(r=n,n={}),angular.isUndefined(n)&&(n={});var t=[];return angular.forEach(e,function(e){var r=i.defer();t.push(r.promise),-1===y.indexOf(e)||angular.isDefined(n)&&n.cache===!1?f.get(e,n).success(function(n){angular.forEach(angular.element(n),function(e){"SCRIPT"===e.nodeName&&"text/ng-template"===e.type&&s.put(e.id,e.innerHTML)}),y.push(e),r.resolve()}).error(function(n){var t='Error load template "'+e+'": '+n;o.error(t),r.reject(new Error(t))}):r.resolve()}),i.all(t).then(function(){r()},function(e){r(e)})};var x=function(e,n){var r=[],t=[],a=[],u=[];if(angular.forEach(e,function(e){/\.css[^\.]*$/.test(e)?r.push(e):/\.(htm|html)[^\.]*$/.test(e)?t.push(e):a.push(e)}),r.length>0){var l=i.defer();h(r,function(e){angular.isDefined(e)?(o.error(e),l.reject(e)):l.resolve()}),u.push(l.promise)}if(t.length>0){var s=i.defer();m(t,n,function(e){angular.isDefined(e)?(o.error(e),s.reject(e)):s.resolve()}),u.push(s.promise)}if(a.length>0){var c=i.defer();p(a,function(e){angular.isDefined(e)?(o.error(e),c.reject(e)):c.resolve()}),u.push(c.promise)}return i.all(u)};return{getModuleConfig:function(e){return v[e]?v[e]:null},setModuleConfig:function(e){return v[e.name]=e,e},getModules:function(){return l},loadTemplateFile:function(e,n){return x(e,n)},load:function(s){var c,f,d=this,g=null,p=[],h=[],m=i.defer();if(angular.isArray(s))return angular.forEach(s,function(e){h.push(d.load(e))}),i.all(h).then(function(){m.resolve(s)}),m.promise;if(c=u(s),"string"==typeof s?(g=d.getModuleConfig(s),g||(g={files:[s]},c=null)):"object"==typeof s&&(g=d.setModuleConfig(s)),null===g?(f='Module "'+c+'" is not configured, cannot load.',o.error(f),m.reject(new Error(f))):angular.isDefined(g.template)&&(angular.isUndefined(g.files)&&(g.files=[]),angular.isString(g.template)?g.files.push(g.template):angular.isArray(g.template)&&g.files.concat(g.template)),p.push=function(e){-1===this.indexOf(e)&&Array.prototype.push.apply(this,arguments)},angular.isDefined(c)&&n(c)&&-1!==l.indexOf(c)&&(p.push(c),angular.isUndefined(g.files)))return m.resolve(),m.promise;var v=function y(t){var a,l,s,c=[];if(a=u(t),null===a)return i.when();try{l=r(a)}catch(f){var g=i.defer();return o.error(f.message),g.reject(f),g.promise}return s=e(l),angular.forEach(s,function(e){if("string"==typeof e){var r=d.getModuleConfig(e);if(null===r)return void p.push(e);e=r}return n(e.name)||-1!==p.indexOf(e.name)?void("string"!=typeof t&&o.warn('Module "',a,'" attempted to redefine configuration for dependency "',e.name,'"\nExisting:',d.getModuleConfig(e.name),"Ignored:",e)):("object"==typeof e&&(e.hasOwnProperty("name")&&e.name&&(d.setModuleConfig(e),p.push(e.name)),e.hasOwnProperty("css")&&0!==e.css.length&&angular.forEach(e.css,function(e){w("css",e)})),void(e.hasOwnProperty("files")&&0!==e.files.length&&e.files&&c.push(x(e.files).then(function(){return y(e)}))))}),i.all(c)};return x(g.files).then(function(){null===c?m.resolve(s):(p.push(c),v(c).then(function(){try{a($,p)}catch(e){return o.error(e.message),void m.reject(e)}t(function(){m.resolve(s)})},function(e){t(function(){m.reject(e)})}))},function(e){m.reject(e)}),m.promise}}}],this.config=function(e){if(p=e.jsLoader||e.asyncLoader,angular.isDefined()&&!angular.isFunction(p))throw"The js loader needs to be a function";if(angular.isDefined(e.cssLoader)&&(h=e.cssLoader),angular.isDefined(e.templatesLoader)&&(m=e.templatesLoader),e.loadedModules){var n=function(e){l.indexOf(e)<0&&(l.push(e),angular.forEach(angular.module(e).requires,n))};angular.forEach(e.loadedModules,n)}e.modules&&(angular.isArray(e.modules)?angular.forEach(e.modules,function(e){v[e.name]=e}):v[e.modules.name]=e.modules),angular.isDefined(e.debug)&&(j=e.debug)}}]),f.directive("ocLazyLoad",["$http","$log","$ocLazyLoad","$compile","$timeout","$templateCache","$animate",function(e,n,r,t,a,o,u){return{restrict:"A",terminal:!0,priority:401,transclude:"element",controller:angular.noop,compile:function(){return function(e,n,t,a,o){function i(){l&&(l.$destroy(),l=null),n.html("")}{var l,s=e.$eval(t.ocLazyLoad);s&&s.onload?s.onload:""}e.$watch(t.ocLazyLoad,function(t){angular.isDefined(t)?r.load(t).then(function(){o(e,function(e){u.enter(e,null,n)})}):i()},!0)}}}}])}();